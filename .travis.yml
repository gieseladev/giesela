sudo: required
cache: pip

language: python

matrix:
  fast_finish: true
  allow_failures:
    - python: "3.8-dev"
  include:
    - python: "3.7"
      dist: xenial    # required for Python 3.7+ (travis-ci/travis-ci#9069)
      sudo: required  # required for Python 3.7+ (travis-ci/travis-ci#9069)
    - python: "3.8-dev"
      dist: xenial    # required for Python 3.8 nightly (travis-ci/travis-ci#9069)
      sudo: required  # required for Python 3.8 nightly (travis-ci/travis-ci#9069)


before_install:
- sudo apt-get install build-essential unzip -y
- sudo apt-get install software-properties-common -y
- sudo add-apt-repository ppa:mc3man/xerus-media -y
- sudo add-apt-repository ppa:deadsnakes/ppa -y
- sudo apt-get update -y --allow-unauthenticated
- sudo apt-get install ffmpeg libopus-dev libffi-dev libsodium-dev -y


install:
- pip install pytest pytest-asyncio
- pip install pipenv
- pipenv sync

script:
- python -m pytest

before_deploy:
- echo building docker image...
- docker build -t "$DOCKER_REPO" .

deploy:
  provider: script
  script: bash ./.travis/docker_push.sh
  on:
    all_branches: true
    python: "3.7"
